```
PHEP: 9999
Title: PyHC standardization around astropy.time.Time
Author: Nabil Freij <nabil.freij@gmail.com> <https://orcid.org/0000-0002-6253-082X>
Discussions-To: https://github.com/heliophysicsPy/standards/pull/X
Revision: 1
Status: Draft
Type: Standards Track
Content-Type: text/markdown; charset=UTF-8; variant=CommonMark
Created: 08-July-2024
Post-History: 08-July-2024
```

# Abstract

This PHEP recommends that all projects across the PyHC ecosystem adopt using `astropy.time.Time` as the foundational class for all time objects.
This process would involve rewriting existing PyHC core packages replace any use of datetime or custom time objects with `astropy.time.Time`.

As this is a major change, the transition needs to be carefully managed and will be broken into stages:

1. Existing core packages will be audited to see how complex their time objects are.
2. Plans to be drawn up on how to tackle all code changes.
3. Funding to be found for this work to go ahead.

For any new packages that are being developed or created, they are recommended to use `astropy.time.Time` from the beginning.

# Motivation

One of the strategic goals of the PyHC Project is to "Coordinate development across projects to minimize duplication of effort".

However, all of the core PyHC packages were created not only before the existence of PyHC.
But also before many core libraries existed within the wider ScientiÔ¨Åc Python ecosystem (from `numpy` to `scipy` to `astropy` to `spiceypy` etc) meant that all core PyHC packages had to create their own implementations of time (and other components like coordinates) due to necessity.

Now that upstream ecosystem has grown at a rapid pace, the need for PyHC core package specific implementations has reduced.
This actually covers at least three areas (time, coordinate and units), however the focus for this PHEP is to start at time as that is considered the "simplest" case for standardization.

# Rationale

One of the main focuses within PyHC should be around the goal of reducing the amount of code that each package has to carry around and maintain to do exactly the same.
This means that the limited time that maintainers or library authors have to focus on their package should be around adding more interesting topics like new features.
This makes the usage of `astropy` very ideal as they are backed with a larger community as well as core team that maintains the library.
It already is the foundation for many packages within astronomy and provides a strong overlap with existing objectives of many packages within PyHC.

Current community objections are:

- This would require funding and that might be difficult based on the currently available sources.
- Potential lack of innovation if packages use the same framework.
- Education of a new time object for existing users of PyHC packages.

# Specification

There are several ways to migrate to `astropy.time.Time`.
The simplest one is if a package is using `datetime`, a near one to one drop-in replacement is possible and would be the simplest transition case.

For libraries that provide datetime as inputs, they should add explicit `astropy.time.Time` support for example like HAPI for example.

For libraries that provide a custom time object, support for `astropy.time.Time` should be added to the existing library and the original time object should be deprecated.
The other choice is to rebase the existing time object onto `astropy.time.Time` to avoid breaking existing user code directly.

All of these come with challenges, there will be features or time formats missing that will need to be created.
For new time formats, they do not have to be added to `astropy`, they can be in the same PyHC package.
The time framework has been designed to be extendable without adding code changes to `astropy`.

If there are missing features, then those will need to be added upstream to `astropy`.

# Backwards Compatibility

This policy introduces backwards incompatibilities by enforcing a new base time object.

To reduce backwards incompatibilities, existing projects will need to add support for `astropy.time` and deprecate old classes or methods.
This provides a time frame for users to know what is going to happen and so they can adjust their code as required.

In other places, it might be possible to take an existing class and underneath make it use `astropy.time`, at least this would not break existing code that users rely on.

Furthermore, the creation of a migration guides so users can see concrete examples of how to migrate their code.
This could be hosted on each package or a larger guide on the PyHC website.

# Security Implications

There are no direct security implications of this policy.
While we would be requiring astropy to be a core dependency of each core project, it sees wide spread usage on government or NASA systems already.

# How to Teach This

- Video meetings to help developers of core packages learn `astropy.time` from either people familiar with `astropy.time` or the astropy developers themselves.
- [`astropy.time` documentation is pretty extensive for infomation.](https://docs.astropy.org/en/stable/time/)
- Creation of migration guides to help users update their existing code.

# Reference Implementation

Using `astropy.time` won't involve having one reference impletnation.
However, both `sunpy` and `plasmapy` use `astropy.time.Time` internally and `sunpy` contains examples of extending `astropy.time.Time` to support extra time formats but also datetime string parsing.

- [New time epoch](https://github.com/sunpy/sunpy/blob/main/sunpy/time/timeformats.py)
- [New datetime string formats](https://github.com/sunpy/sunpy/blob/main/sunpy/time/time.py#L37)

# Rejected Ideas

None so far.

# Open Issues

1. What should the time frame be for package transitions?
2. How do we handle `astropy.time` lack of support in pandas or xarray?
3. Need to figure out what the missing features of `astropy.time` are compared to existing time objects within the PyHC core packages.

# Footnotes

None so far.

# Revisions

Revision 1 (pending): Initial draft.

# Copyright

This document is placed in the public domain or under the CC0-1.0-Universal license, whichever is more permissive.
It should be cited as:

```bibtex
@techreport(phep9999,
  author = {Nabil Freij},
  title  = {PyHC time standardization},
  year = {2024},
  type = {PHEP},
  number = {3},
  doi = {10.5281/zenodo.xxxxxxx}
)
```
